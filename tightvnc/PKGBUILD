# Maintainer: Severus <severus@theslinux.org>
# Original Maintainer: Alexander RÃ¸dseth <rodseth@gmail.com>
# Original Contributor: Paul Mattal <paul@archlinux.org>
# Original Contributor: Andrew Hills <hills.as@gmail.com>
# Original Contributor: John <graysky@archlinux.us>

pkgdesc='VNC server and viewer'
arch=('x86_64' 'i686')
license=('GPL')
url='http://www.tightvnc.com'
depends=('libjpeg' 'zlib' 'libxaw' 'libxp' 'xorg-xauth' 'perl')
makedepends=('imake' 'setconf' 'gendesk')
options=('!makeflags')
source=("http://downloads.sf.net/sourceforge/vnc-tight/$pkgbase-${pkgver}_unixsrc.tar.bz2"
        'http://people.csail.mit.edu/jaffer/Color/rgb.txt'
        'vncserver.service'
        'tightvnc.png::http://virtual.itca.edu.sv/dokeos/sinapsis/cd/redes/vnc/tightvnc/documentos/TightVNC%20Frequently%20Asked%20Questions_archivos/tightvnc-logo.jpg')
_exec=('vncviewer')
_name=('TightVNC Viewer')
_categories=('Application;Network;'

build() {
  cd $srcdir
  gendesk -n

  cd vnc_unixsrc
  setconf vncserver '$vncClasses' \"/usr/share/tightvnc\"\;
  setconf vncserver '$fontPath' \
    \"/usr/share/fonts/misc/,/usr/share/fonts/75dpi/,/usr/share/fonts/100dpi/,/usr/share/fonts/Type1/\"\;
  sed -i 's:/lib/cpp:/usr/bin/cpp:' Xvnc/config/cf/linux.cf
  xmkmf
  make World

  cd Xvnc
  ./configure
  setconf programs/Xserver/dix/Makefile DEFAULTRGBDATABASE '/usr/share/tightvnc/rgb'
  setconf programs/Xserver/os/Makefile PROTO_DEFINES "-D_XOPEN_SOURCE=500L"
  setconf lib/font/fc/Makefile PROTO_DEFINES "-D_XOPEN_SOURCE=500L"
  make
}

package() {
  cd $srcdir/vnc_unixsrc
  mkdir -p $pkgdir/usr/bin $pkgdir/usr/share/man/man1
  ./vncinstall $pkgdir/usr/bin $pkgdir/usr/share/man
  mkdir -p $pkgdir/usr/share/$pkgbase

  cd $srcdir
  install -Dm644 vnc_unixsrc/classes/* \
    $pkgdir/usr/share/$pkgbase
  install -Dm644 rgb.txt $pkgdir/usr/share/$pkgbase/rgb.txt
  install -Dm644 $pkgbase.desktop \
    $pkgdir/usr/share/applications/$pkgbase.desktop
  install -Dm644 $pkgbase.png \
    $pkgdir/usr/share/pixmaps/$pkgbase.png
  install -Dm644 vncserver.service \
    $pkgdir/usr/lib/systemd/system/vncserver.service
}

# vim:set ts=2 sw=2 et:
