# Maintainer: Severus <severus@theslinux.org>
# Original Maintainer: Pierre Schmitz <pierre@archlinux.de>

pkgdesc="Rotates system logs automatically"
arch=('i686' 'x86_64')
url="https://fedorahosted.org/logrotate/"
license=('GPL')
groups=('base')
depends=('popt' 'gzip' 'acl')
optdepends=('cron: scheduled log rotation')
backup=('etc/logrotate.conf')
source=("https://fedorahosted.org/releases/l/o/logrotate/logrotate-${pkgver}.tar.gz"
        'noasprintf.patch'
        'paths.patch'
        'logrotate.conf'
        'logrotate.cron.daily')

build() {
	cd "$srcdir/${pkgbase}-${pkgver}"

	patch -p0 -i "$srcdir/noasprintf.patch"
	patch -p0 -i "$srcdir/paths.patch"

	make WITH_ACL=yes RPM_OPT_FLAGS="$CFLAGS" EXTRA_LDFLAGS="$LDFLAGS"
}

check() {
	cd "$srcdir/${pkgbase}-${pkgver}"
	make test
}

package() {
	cd "$srcdir/${pkgbase}-${pkgver}"
	make PREFIX="$pkgdir" MANDIR="/usr/share/man" install

	install -Dm644 "$srcdir/logrotate.conf" "$pkgdir/etc/logrotate.conf"
	install -Dm744 "$srcdir/logrotate.cron.daily" "$pkgdir/etc/cron.daily/logrotate"
}
