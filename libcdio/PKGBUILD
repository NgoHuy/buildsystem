# Maintainer: Severus <severus@theslinux.org>
# Original Maintainer:
# Original Contributor: damir <damir@archlinux.org>

pkgdesc="GNU Compact Disc Input and Control Library"
arch=('i686' 'x86_64')
license=('GPL3')
url="http://www.gnu.org/software/libcdio/"
depends=('libcddb' 'ncurses' 'gcc-libs')
options=('!libtool')
install=libcdio.install
source=(http://ftp.gnu.org/gnu/libcdio/${pkgbase}-${pkgver}.tar.gz{,.sig}
        libcdio-0.83-linking.patch
        udf-Dont-return-freed-memory-from-udf_fopen.patch)

build() {
  cd "${srcdir}/${pkgbase}-${pkgver}"
  patch -Np1 -i ../libcdio-0.83-linking.patch
  patch -Np1 -i ../udf-Dont-return-freed-memory-from-udf_fopen.patch
  ./configure --prefix=/usr --disable-vcd-info --enable-cpp-progs --disable-static
  make
}

package() {
  cd "${srcdir}/${pkgbase}-${pkgver}"
  make -j1 DESTDIR="${pkgdir}" install
  
  sed -i "/LIBCDIO_SOURCE_PATH/s|.*|/* #undef LIBCDIO_SOURCE_PATH */|" \
    $pkgdir/usr/include/cdio/cdio_config.h
}
