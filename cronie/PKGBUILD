# Maintainer: Anh K. Huynh <kyanh@theslinux.org>
# Contributor: Kaiting Chen <kaiting.chen@kiwilight.com>
# Maintainer: Gaetan Bisson <bisson@archlinux.org>

pkgdesc='Daemon that runs specified programs at scheduled times and related tools'
url='https://fedorahosted.org/cronie/'
license=('custom:BSD')
arch=('i686' 'x86_64')
depends=('pam' 'bash' 'run-parts')
optdepends=('pm-utils: defer anacron on battery power'
      'smtp-server: send job output via email'
      'smtp-forwarder: forward job output to email server')

source=(
  "https://fedorahosted.org/releases/c/r/${pkgbase}/${pkgbase}-${pkgver}.tar.gz"
  'service'
  'pam.d'
  'syscrontab'
  'deny')

backup=('etc/cron.deny'
  'etc/pam.d/crond'
  'etc/crontab')

conflicts=('cron')
provides=('cron')
groups=('base')

build() {
  cd "${srcdir}/${pkgname}-${pkgver}"
  ./configure \
    --prefix=/usr \
    --sysconfdir=/etc \
    --localstatedir=/var \
    --sbindir=/usr/bin \
    --disable-anacron \
    --with-inotify \
    --with-pam \
    --with-syscrontab

  make
}

package() {
  cd "${srcdir}/${pkgname}-${pkgver}"

  make DESTDIR="${pkgdir}" install

  chmod u+s "${pkgdir}"/usr/bin/crontab
  install -d "${pkgdir}"/var/spool/cron
  install -d "${pkgdir}"/etc/cron.{d,hourly,daily,weekly,monthly}

  install -Dm644 ../deny "${pkgdir}"/etc/cron.deny
  install -Dm644 ../pam.d "${pkgdir}"/etc/pam.d/crond
  install -Dm644 ../service "${pkgdir}"/usr/lib/systemd/system/cronie.service

  install -Dm644 ../syscrontab "${pkgdir}"/etc/crontab

  install -Dm644 COPYING "${pkgdir}"/usr/share/licenses/cronie/COPYING
}
