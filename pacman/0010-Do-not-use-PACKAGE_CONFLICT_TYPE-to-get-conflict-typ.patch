From c0f8c7a3940f999d2841393cedc95d303dd90290 Mon Sep 17 00:00:00 2001
From: Ky-Anh Huynh <kyanh@theslinux.org>
Date: Fri, 18 Oct 2013 09:20:56 +0700
Subject: [PATCH] Do not use PACKAGE_CONFLICT_TYPE to get conflict type

---
 pacman/src/pacman-4.1.0/scripts/makepkg.sh.in | 9 ++++-----
 1 file changed, 4 insertions(+), 5 deletions(-)

diff --git a/pacman/src/pacman-4.1.0/scripts/makepkg.sh.in b/pacman/src/pacman-4.1.0/scripts/makepkg.sh.in
index b5fdfd2..33c38ef 100644
--- a/pacman/src/pacman-4.1.0/scripts/makepkg.sh.in
+++ b/pacman/src/pacman-4.1.0/scripts/makepkg.sh.in
@@ -91,11 +91,10 @@ FORCE_VER=""
 
 PACMAN_OPTS=
 
-# Return the feature string to used in filename
-if [[ -n "$PACKAGE_FEATURE" ]]; then
-	_FEATURE_STRING="${PACKAGE_CONFLICT_TYPE}$PACKAGE_FEATURE"
-else
+if [[ -z "${PACKAGE_FEATURE}" || -z "${PACKAGE_FEATURE:1}" ]]; then
 	_FEATURE_STRING=""
+else
+	_FEATURE_STRING="${PACKAGE_FEATURE}"
 fi
 
 shopt -s extglob
@@ -1816,7 +1815,7 @@ write_pkginfo() {
 	mapfile -t provides < <(find_libprovides)
 	mapfile -t depends < <(find_libdepends)
 
-	if [[ "$PACKAGE_CONFLICT_TYPE" == "@" ]]; then
+	if [[ "${PACKAGE_FEATURE:0:1}" == "@" ]]; then
 		conflicts=("${conflicts[@]}" "$pkgname")
 		provides=("${provides[@]}" "$pkgname")
 	fi
-- 
1.8.4
