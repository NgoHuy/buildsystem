#Maintainer: Severus <severus@theslinux.org>
# Original Maintainer: Daniel Wallace <danielwallace at gtmanfred dot com>
# Original Contributor: Lucas De Marchi <lucas.de.marchi@gmail.com>

pkgdesc="Wireless LAN network manager"
url="http://connman.net/"
arch=('i686' 'x86_64')
license=('GPL2')
depends=('dbus-core' 'iptables' 'gnutls' 'glib2')
conflicts=('openresolv')
optdepends=('bluez: Support for Bluetooth devices'
            'wpa_supplicant: For WiFi devices'
            'pptpclient: for ppp support')
makedepends=('bluez' 'wpa_supplicant' 'openconnect' 'openvpn' 'ppp')
options=('!libtool')
source=("http://www.kernel.org/pub/linux/network/${pkgbase}/${pkgbase}-${pkgver}.tar.bz2"
        'allow_group_network.diff')

prepare(){
  cd "${srcdir}/${pkgbase}-${pkgver}"
  patch -Np1 -i "${srcdir}/allow_group_network.diff"
}

build() {
  cd "${srcdir}/${pkgbase}-${pkgver}"

  ./configure --prefix=/usr --sysconfdir=/etc --localstatedir=/var \
	  --bindir=/usr/bin \
	  --sbindir=/usr/bin \
      --with-systemdunitdir=/usr/lib/systemd/system \
      --enable-threads \
      --enable-pptp \
      --enable-openconnect \
      --enable-vpnc \
      --enable-openvpn \
      --enable-polkit \
      --enable-client

  make
}

package(){
  make -C "${srcdir}/${pkgbase}-${pkgver}" DESTDIR="${pkgdir}" install
  install -Dm755 "$srcdir/$pkgbase-$pkgver/client/${pkgbase}ctl" "$pkgdir/usr/bin/${pkgbase}ctl"
  find "$pkgdir/usr" -name \*.service -exec sed -i 's/s\(bin\)/\1/' {} +
}
