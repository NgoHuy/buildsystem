# Maintainer: Severus <severus@theslinux.org>
# Original Maintainer: Andrea Scarpino <andrea@archlinux.org>

pkgdesc="A Qt interface to the Zeitgeist event tracking system"
url='https://projects.kde.org/projects/kdesupport/libqzeitgeist'
arch=('i686' 'x86_64')
license=('GPL')
depends=('qt4')
makedepends=('cmake' 'automoc4' 'python2' 'zeitgeist')
source=("http://download.kde.org/stable/${pkgbase}/${pkgver}/src/${pkgbase}-${pkgver}.tar.bz2"
        'set-declarative-installation-dir.patch')

build() {
  . /etc/profile.d/qt4.sh

  cd ${pkgbase}-${pkgver}
  patch -p1 -i "${srcdir}"/set-declarative-installation-dir.patch
  cd ../

  # Fix python2 path
  sed -i 's|/usr/bin/env python|/usr/bin/env python2|' \
    ${pkgbase}-${pkgver}/scripts/onto2cpp.py

  mkdir build
  cd build
  cmake ../${pkgbase}-${pkgver} \
    -DCMAKE_BUILD_TYPE=Release \
	-DCMAKE_INSTALL_PREFIX=/usr \
    -DDECLARATIVE_IMPORT_PREFIX=/usr/lib/qt4/imports/
  make
}

package() {
  cd build
  make DESTDIR="${pkgdir}" install
}
